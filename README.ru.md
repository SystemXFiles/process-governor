# Process Governor

![Logo Process Governor](src/resource/favicon.ico)

**Process Governor** - это утилита на Python, предназначенная для управления процессами и службами в Windows путем
настройки их приоритетов, приоритетов ввода/вывода и привязки к ядрам на основе пользовательских правил, заданных в
JSON-конфигурации.

[English README](README.md)

## Возможности

- Настройка приоритетов процессов и служб для повышения производительности.
- Управление приоритетами ввода/вывода для оптимизации использования ресурсов.
- Определение привязки к ядрам для процессов.
- Тонкая настройка процессов и служб Windows на основе пользовательских правил в файле `config.json`.

## Начало работы

Для использования Process Governor выполните следующие шаги:

1. Склонируйте этот репозиторий.
2. Установите необходимые зависимости с помощью `pip`: `pip install -r requirements.txt`
3. Настройте правила в файле `config.json`. Вы можете создать файл `config.json`, запустив программу один раз.
4. Запустите скрипт `process-governor.py`: `python process-governor.py`

Программу можно закрыть, обратившись к значку в системном трее.

## Создание портабельной сборки

Вы можете создать портативную версию программы, используя **pyvan**. Чтобы создать портативную версию, выполните следующие шаги:

1. Установите pyvan с помощью `pip install pyvan`.
2. Запустите скрипт `python build_portable.py`.
3. После завершения скрипта, вы найдете портативную версию в папке `dist`.

Теперь у вас есть портабельная версия программы, которую можно использовать без установки.

## Формат Конфигурации

Файл конфигурации для Process Governor имеет формат JSON. Ниже мы описываем структуру и доступные параметры в
файле `config.json`.

### Структура JSON для сериализации

Для правильной десериализации с использованием jsonpickle убедитесь, что в JSON-конфигурации присутствуют следующие
теги "py/object":

- `"py/object": "configuration.config.Config"`
- `"py/object": "configuration.logs.Logs"`
- `"py/object": "configuration.rule.Rule"`
- `"py/object": "psutil._pswindows.Priority"`
- `"py/object": "psutil._pswindows.IOPriority"`

#### Оценка Правил

- Правила для процессов оцениваются в том порядке, в котором они указаны в файле конфигурации.
- Правила для служб имеют более высокий приоритет, чем правила для процессов, и переопределяют их, если найдено
  совпадение с службой.

### Секция `rules`

Секция `rules` определяет, как Process Governor будет управлять процессами и службами. Каждое правило представлено как
JSON-объект в массиве.

- `processSelector` (строка, опционально): Указывает имя процесса или шаблон для сопоставления. Вы можете использовать
  подстановочные символы, включая `*` и `?`, чтобы сопоставить несколько процессов.
    - Пример: `"processSelector": "example.exe"`
    - Пример с подстановочными символами: `"processSelector": "logioptionsplus_*.exe"`

- `serviceSelector` (строка, опционально): Указывает имя службы или шаблон для сопоставления. Вы можете использовать
  подстановочные символы, включая `*` и `?`, чтобы сопоставить несколько служб. Правила для служб имеют более высокий
  приоритет и переопределяют правила для процессов, если найдено совпадение.
    - Пример: `"serviceSelector": "MyService"`
    - Пример с подстановочными символами: `"serviceSelector": "Audio*"`

- `priority` (строка, опционально): Устанавливает приоритет процесса или службы. Допустимые значения:
    - `"Idle"`
    - `"BelowNormal"`
    - `"Normal"`
    - `"AboveNormal"`
    - `"High"`
    - `"Realtime"`
    - Пример: `"priority": { "py/object": "psutil._pswindows.Priority", "value": "High" }`

- `ioPriority` (строка, опционально): Устанавливает приоритет ввода/вывода для процесса или службы. Допустимые значения:
    - `"VeryLow"`
    - `"Low"`
    - `"Normal"`
    - `"High"`: Установка приоритета ввода-вывода на "High" может вызвать ошибку AccessDenied в большинстве случаев.
    - Пример: `"ioPriority": { "py/object": "psutil._pswindows.IOPriority", "value": "Normal" }`

- `affinity` (строка, опционально): Определяет привязку процесса к ядру CPU. Вы можете указать привязку следующим
  образом:
    - Диапазон, включительно (например, "1-5").
    - Конкретные ядра (например, "1;2;3;4;5").
    - Комбинация обоих вариантов (например, "1-4;5").
    - Пример (диапазон): `"affinity": "1-4"`
    - Пример (конкретные ядра): `"affinity": "0;2;4"`
    - Пример (комбинация): `"affinity": "1;3-5"`

### Пример Конфигурации

Вот пример файла `config.json` с правилами:

```json
{
  "py/object": "configuration.config.Config",
  "ruleApplyIntervalSeconds": 1,
  "logging": {
    "py/object": "configuration.logs.Logs",
    "enable": false,
    "filename": "logging.txt",
    "level": "WARN",
    "maxBytes": 1048576,
    "backupCount": 2
  },
  "rules": [
    {
      "py/object": "configuration.rule.Rule",
      "processSelector": "example.exe",
      "priority": {
        "py/object": "psutil._pswindows.Priority",
        "value": "High"
      },
      "ioPriority": {
        "py/object": "psutil._pswindows.IOPriority",
        "value": "Normal"
      },
      "affinity": "1;3-5"
    },
    {
      "py/object": "configuration.rule.Rule",
      "serviceSelector": "Audio*",
      "priority": {
        "py/object": "psutil._pswindows.Priority",
        "value": "Realtime"
      },
      "ioPriority": {
        "py/object": "psutil._pswindows.IOPriority",
        "value": "High"
      },
      "affinity": "0;2;4"
    }
  ]
}
```

В этом примере определены два правила: одно для процесса и одно для службы. Правила для служб имеют приоритет над
правилами для процессов, если найдено совпадение с службой.

### Лицензия

Этот проект лицензирован согласно GNU General Public License v3.0 - см. файл [LICENSE](LICENSE) для подробностей.